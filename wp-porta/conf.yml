hosts:
  '7io.org':
    listen:
      port: 8080
    file.index: ['index.html', 'index.php']
    paths:
      '/wp/xmlrpc.php':
        redirect:
          url: 'https://google.com/'
          status: 307
      '/wp/wp-config.php':
        redirect:
          url: 'https://google.com/'
          status: 307
          url: 'https://google.com/'
          status: 307
      '/wp/':
        file.dir: /www/wp
        setenv:
          HTTPS: on
      '/':
        file.dir: /www/top
        setenv:
          HTTPS: on
        mruby.handler: |
          lambda do |env|
            if /(.*)/.match(env["PATH_INFO"])
              return [307, {"x-reproxy-url" => "/wp/index.php?q=#{$1}"}, []]
            end
            return [399, {}, []]
          end

file.custom-handler:
  extension: '.php'
  #fastcgi.send-delegated-uri: ON
  fastcgi.connect:
    host: 'wp-php'
    port: 9000
    type: tcp

access-log: /dev/stdout
error-log: /dev/stderr
http2-reprioritize-blocking-assets: ON

